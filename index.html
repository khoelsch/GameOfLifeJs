<html>
  <head>
    <title>JavaScript implementation of Convay's Game Of Life</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
  </head>
  <body>
  
    <script type="text/javascript">
      /**
       * Assumptions:
       *
       *  - the field is a finite, two-dimensional square field with 'edgeSize' fields on each side
       *  - the first cell is the TOP LEFT corner
       *  - to be precise, the field is indexed as follows:
       *    ('r' for row index; 'c' for column index)
       *
       *       r0c0 r0c1 r0c2 r0c3
       *       r1c0 r1c1 r1c2 r1c3
       *       r2c0 r2c1 r2c2 r2c3
       */
      function GameOfLifeField(edgeSize) {
        // retain context for "private" helper functions
        var newGolField = this;

        // "private" field
        var field = new Array();
        for (var i=0; i<edgeSize; ++i) {
          field.push(new Array(edgeSize));
        }

        /**
         * Method that returns the state of a cell:
         *  -> true = living cell
         *  -> false = dead cell
         */
        this.cellAliveAt = function (row, col) {
          return !!field[row][col];
        };


        this.performLifecycle = function() {
          for (var row=0; row<edgeSize; ++row) {
            for (var col=0; col<edgeSize; ++col) {
              if (livingNeighborsCount(row,col) < 2) {
                newGolField.setCell(row, col, false);
              }
            }
          }
        };

        this.setCell = function(row,col, newState) {
          field[row][col] = newState;
        };

        //
        // "private" helper functions
        //
        var livingNeighborsCount = function(row, col) {
          var count = 0;
          for (var rowOffset = -1; rowOffset<=1; ++rowOffset) {
            for (var colOffset = -1; colOffset<=1; ++colOffset) {
              var tmpRow = row + rowOffset;
              var tmpCol = col + colOffset;
              if (isValidIndex(tmpRow)
                      && isValidIndex(tmpCol)
                      && newGolField.cellAliveAt(tmpRow, tmpCol)) {
                ++count;
              }
            }
          }
          return count;
        };

        var isValidIndex = function (index) {
          return (index > 0) && (index < edgeSize);
        };
      };

      //
      // Add methods to GameOfLifeField's prototype
      //

      /**
       * Method that returns the state of a cell:
       *  -> true = living cell
       *  -> false = dead cell
       */
      /*
      GameOfLifeField.prototype.livingCellAt = function (row, col) {
        return !!this.field[row][col];
      };
      */
      /*GameOfLifeField.prototype.isValidIndex = function (index) {
        return (index > 0) && (index < this.edgeSize);
      };*/

      //
      // Helper function to display test results
      //
      function assert(expr, assumption) {
        var li = document.createElement('li');
        li.className = !!expr ? 'success' : 'failure';
        li.appendChild(document.createTextNode(assumption));
        document.getElementById('testResults').appendChild(li);
      };


      //
      // The tests
      //
      function assertNewFieldContainsOnlyDeadCells() {
        var edgeSize = 3;
        var golField = new GameOfLifeField(edgeSize);
        var allCellsAreDead = true;

        for (var row=0; row<edgeSize; ++row) {
          for (var col=0; col<edgeSize; ++col) {
            if (golField.cellAliveAt(row, col)) {
              allCellsAreDead = false;
            }
          }
        }

        assert(allCellsAreDead, 'All cells are dead in a newly created Game Of Life.')
      };

      function assertChangingCellStateWorks() {
        var edgeSize = 3;
        var golField = new GameOfLifeField(edgeSize);

        golField.setCell(0, 0, true);
        golField.setCell(0, 1, false);

        var stateWasSaved = golField.cellAliveAt(0,0) && !golField.cellAliveAt(0,1);
        assert(stateWasSaved, 'Changing cell state has effect.')
      }

      // Starting to test for 1. Rule: 'Cell dies, if less that TWO living neighbours')
      function assertRuleOneHolds_allCellsDie() {
        var edgeSize = 3;
        var golField = new GameOfLifeField(edgeSize);

        // only one living cell in each corner
        golField.setCell(0, 0, true);
        golField.setCell(0, 2, true);
        golField.setCell(2, 0, true);
        golField.setCell(2, 2, true);

        golField.performLifecycle();

        var allCellsAreDead = !golField.cellAliveAt(0, 0)
          && !golField.cellAliveAt(0, 2)
          && !golField.cellAliveAt(2, 0)
          && !golField.cellAliveAt(2, 2);
        assert(allCellsAreDead, 'All cells died!');
      }

      function assertRuleOneHolds_twoNeighborCellsLive() {
        /*var edgeSize = 3;
        /*var edgeSize = 3;
        var golField = new GameOfLifeField(edgeSize);

        golField.setCell(0, 0, true);
        golField.setCell(0, 1, true);

        golField.performLifecycle();

        // TODO.....................

        var bothCellsAreAlive = golField;
        */
      }

      //
      // Execute our code, when document is loaded
      //
      window.onload = function() {
        assertNewFieldContainsOnlyDeadCells();
        assertChangingCellStateWorks();
        assertRuleOneHolds_allCellsDie();
        // assertRuleOneHolds_twoNeighborCellsLive()
      };
    </script>
  
    <ul id="testResults"></ul>
  </body>
</html>